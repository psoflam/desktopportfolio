<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colin Mays — Desktop Portfolio</title>
  <meta name="theme-color" content="#0b0f17" />
  <link rel="stylesheet" href="css/base.css" />
</head>
<body>
  <!-- Desktop wallpaper + grid -->
  <canvas id="dot-grid" aria-hidden="true"></canvas>

  <!-- Desktop surface (windows get appended here) -->
  <div id="desktop" role="application" aria-label="Desktop"></div>

  <!-- Taskbar -->
  <footer id="taskbar" role="toolbar" aria-label="Taskbar">
    <div class="taskbar-left">
      <button class="brand" aria-label="Start">CM</button>
      <button class="task-btn" data-app="about" aria-controls="about">About</button>
      <!-- We'll add Projects later -->
    </div>
    <div class="taskbar-right">
      <button id="theme-toggle" aria-pressed="false" aria-label="Toggle theme">☾</button>
      <time id="clock" aria-live="polite"></time>
    </div>
  </footer>

  <script type="module">
    import { WindowManager } from './js/wm.js';
    import { mountAbout } from './js/apps/about.js';
    import { initTaskbar } from './js/taskbar.js';

    // Boot background grid
    const cvs = document.getElementById('dot-grid');
    const ctx = cvs.getContext('2d');
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const cfg = { spacing: 32, radius: 1.4, color: 'rgba(255,255,255,0.14)', alt: 'rgba(255,255,255,0.06)', nth: 5 };
    function size() {
      const w = innerWidth, h = innerHeight;
      cvs.width = w * DPR; cvs.height = h * DPR;
      cvs.style.width = w+'px'; cvs.style.height = h+'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
      draw();
    }
    function draw() {
      const w = cvs.width / DPR, h = cvs.height / DPR;
      ctx.clearRect(0,0,w,h);
      ctx.save();
      ctx.translate((w % cfg.spacing)/2, (h % cfg.spacing)/2);
      let i=0;
      for (let y=0; y<=h+cfg.spacing; y+=cfg.spacing) {
        for (let x=0; x<=w+cfg.spacing; x+=cfg.spacing) {
          ctx.fillStyle = (i++ % cfg.nth === 0) ? cfg.alt : cfg.color;
          ctx.beginPath(); ctx.arc(x,y,cfg.radius,0,Math.PI*2); ctx.fill();
        }
      }
      ctx.restore();
    }
    addEventListener('resize', () => requestAnimationFrame(size));
    size();

    // Boot Window Manager + Taskbar
    const desktop = document.getElementById('desktop');
    const wm = new WindowManager(desktop);
    initTaskbar({ wm, apps: {
      about: { title: 'About Me', mount: mountAbout }
    }});

    // Optional: open About on load once
    wm.openWindow('about', { title: 'About Me', mount: mountAbout });
  </script>
</body>
</html>
